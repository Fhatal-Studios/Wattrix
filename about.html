<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Wattrix • About & FAQ</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#070b14" />

<!-- Futuristic fonts -->
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

<!-- Favicon (neon bolt) -->
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%237559ff'/%3E%3Cstop offset='1' stop-color='%2338fbd0'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpolygon points='24,4 44,28 32,28 48,60 20,32 34,32' fill='url(%23g)'/%3E%3C/svg%3E">

<style>
/* =========================================================
   WATTRIX / FIGMA TOKENS — keep IDENTICAL to other pages
   =======================================================*/
:root{
  /* Color */
  --bg-0:#070b14;
  --bg-1:#0b1222;
  --bg-2:#0f1830;
  --stroke:#1e2b52;
  --text:#e8ecf8;
  --muted:#9ba6bf;

  --brand-1:#7559ff;
  --brand-2:#38fbd0;
  --brand-3:#2dd4ff;

  /* Gradients */
  --grad-hero: radial-gradient(1200px 700px at 20% -10%, rgba(117,89,255,.22), transparent 60%),
               radial-gradient(1200px 700px at 80% 10%, rgba(56,251,208,.18), transparent 60%),
               linear-gradient(180deg, #070b14 0%, #090f1c 60%, #070b14 100%);
  --grad-card: linear-gradient(180deg, rgba(21,30,58,.55), rgba(13,21,43,.55));
  --grad-border: conic-gradient(from 180deg at 50% 50%, rgba(117,89,255,.6), rgba(45,212,255,.6), rgba(56,251,208,.6), rgba(117,89,255,.6));

  /* Effects */
  --radius-xl:24px;
  --radius-lg:18px;
  --radius-md:14px;
  --shadow-lg:0 30px 80px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.03);
  --shadow-sm:0 8px 24px rgba(0,0,0,.35);
  --glass:backdrop-filter: blur(16px);
  --ring-focus:0 0 0 4px rgba(117,89,255,.25);

  /* Typography */
  --font-sans:'Space Grotesk', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  --font-mono:'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, monospace;

  /* Spacing scale */
  --s-1:6px; --s-2:10px; --s-3:14px; --s-4:18px; --s-5:22px; --s-6:28px; --s-7:36px; --s-8:48px; --s-9:64px; --s-10:92px;
}

/* Base */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text); background:var(--bg-0);
  font:16px/1.6 var(--font-sans);
}

/* Global layout */
.container{max-width:1200px; margin:0 auto; padding:0 var(--s-4);}
.section{padding: var(--s-8) 0; position:relative}

/* Neon grid background */
.bg-grid{
  position:fixed; inset:0; z-index:-1;
  background-image:
    linear-gradient(to right, rgba(255,255,255,.04) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(255,255,255,.04) 1px, transparent 1px);
  background-size: 28px 28px;
  mask-image: radial-gradient(1000px 600px at 50% 10%, black 50%, transparent 100%);
}

/* NAV — EXACTLY LIKE index.html */
.nav{
  position:sticky; top:0; z-index:50;
  backdrop-filter: blur(10px);
  background: linear-gradient(180deg, rgba(7,11,20,.75), rgba(7,11,20,.45));
  border-bottom:1px solid rgba(45,64,120,.35);
}
.nav-inner{
  max-width:1200px; margin:0 auto; padding: var(--s-2) var(--s-4);
  display:flex; align-items:center; gap:var(--s-3); justify-content:space-between;
  flex-wrap:wrap;
}
@media(max-width:700px){
  .nav-inner{
    flex-direction:column;
    align-items:flex-start;
    gap:12px;
  }
  .nav .brand{margin-bottom:8px;}
  .nav .links{margin-bottom:8px;}
  .nav-cta{width:100%; display:flex; gap:10px; flex-wrap:wrap;}
}
.brand{
  display:flex; align-items:center; gap:12px; text-decoration:none; color:var(--text);
}
.brand .bolt{width:32px; height:32px}
.brand .name{font-weight:700; letter-spacing:.2px}
.nav-cta{display:flex; gap:10px; align-items:center;}
.nav a{
  color:var(--text); text-decoration:none; padding:10px 14px; border-radius:10px;
  border:1px solid transparent;
}
.nav a:hover{border-color:#2a3869}
.nav a.active{
  background:#0f1830; border:1px solid #2a3869;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
}
.btn{
  appearance:none; border:1px solid #2a3869; color:var(--text); background:#0c1429;
  padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600;
}
.btn:hover{border-color:#5d79ff}
.btn.primary{
  background: linear-gradient(90deg, rgba(117,89,255,.18), rgba(56,251,208,.18));
  border-image: var(--grad-border) 1;
  box-shadow: var(--shadow-sm);
}

/* Header */
.header{
  padding: var(--s-9) 0 var(--s-6);
  background: var(--grad-hero);
  position:relative;
}
.header h1{
  margin:0; font-size: clamp(34px, 5.5vw, 56px); line-height:1.05; letter-spacing:.2px;
}
.header .lead{color:var(--muted); margin-top: var(--s-4); font-size: clamp(16px, 2.2vw, 20px)}

/* Cards / blocks */
.grid{display:grid; gap:16px}
@media(min-width:960px){.grid.cols-2{grid-template-columns:1fr 1fr}}
@media(min-width:1080px){.grid.cols-3{grid-template-columns:repeat(3,1fr)}}
@media(max-width:959px){.grid.cols-2{grid-template-columns:1fr}}
@media(max-width:1079px){.grid.cols-3{grid-template-columns:1fr}}
@media(max-width:600px){
  .container{padding:0 8px;}
  .section{padding:32px 0;}
}

.card{
  position:relative; border-radius: var(--radius-xl);
  background: var(--grad-card);
  border:1px solid rgba(42,56,105,.6);
  box-shadow: var(--shadow-lg);
  padding:22px;
}
.card h2{margin:0 0 8px 0; font-size:22px}
.card .muted{color:var(--muted)}
.pill{display:inline-block; padding:6px 10px; border:1px solid #31427d; background:#0e1730; border-radius:999px; font-size:12px; margin:6px 8px 0 0}
.mono{font-family:var(--font-mono); font-size:13px; color:#b7c3e0}

/* FAQ */
details{border:1px solid #1c2540; border-radius:14px; background:#10182c; overflow:hidden}
summary{padding:12px 14px; cursor:pointer; list-style:none}
summary::-webkit-details-marker{display:none}
details + details{margin-top:10px}
.faq-body{padding:12px 14px 16px; color:#dbe3f0}

/* Footer */
footer{padding:24px 0; color:#a7b3ce; text-align:center; border-top:1px solid rgba(45,64,120,.35)}
footer .btn-inline{margin-left:8px}

/* Loading overlay (shared) */
#loadingOverlay{
  position:fixed; inset:0; z-index:9999; display:flex; align-items:center; justify-content:center;
  background: radial-gradient(800px 400px at 50% 10%, rgba(117,89,255,.12), transparent 60%), var(--bg-0);
  transition: opacity .6s cubic-bezier(.4,0,.2,1);
}
#loadingOverlay.hide{opacity:0; pointer-events:none}
.loading-icon{width:84px; height:84px; animation:spin 1.2s linear infinite; display:block; filter: drop-shadow(0 0 16px rgba(117,89,255,.55))}
@keyframes spin{to{transform:rotate(360deg)}}

/* Focus */
:focus-visible{outline:none; box-shadow: var(--ring-focus)}

/* ===== Cookie banner + modal ===== */
.cookie-banner{
  position: fixed; left:0; right:0; bottom:0; z-index:60; padding:14px;
  background: linear-gradient(180deg, rgba(21,30,58,.85), rgba(13,21,43,.85));
  border-top: 1px solid rgba(58,76,140,.55); box-shadow: 0 -12px 40px rgba(0,0,0,.35);
}
.cb-inner{max-width:980px; margin:0 auto; display:grid; gap:12px; align-items:center; grid-template-columns:1fr}
.cb-text{font-size:14px}
.cb-text small{color:var(--muted)}
.cb-actions{display:flex; gap:10px; flex-wrap:wrap}
.cb-actions .btn{padding:10px 14px; border-radius:12px}
.cb-actions .btn.primary{background: linear-gradient(90deg, rgba(117,89,255,.22), rgba(56,251,208,.22)); border-image: var(--grad-border) 1}
@media(min-width:720px){ .cb-inner{grid-template-columns:1fr auto} }
.cb-hidden{display:none}

.modal-backdrop{
  position:fixed; inset:0; z-index:70; display:none;
  background: rgba(5,8,16,.6); backdrop-filter: blur(8px);
}
.modal{max-width:720px; margin:10vh auto; border-radius:18px; border:1px solid rgba(58,76,140,.55);
  background: linear-gradient(180deg, rgba(22,30,62,.9), rgba(14,21,43,.9)); box-shadow: var(--shadow-lg); padding:20px}
.modal h3{margin:0 0 10px 0}
.row{display:flex; align-items:flex-start; gap:12px; padding:10px 0; border-top:1px solid rgba(45,64,120,.35)}
.row:first-of-type{border-top:none}
.switch{display:inline-flex; align-items:center; gap:10px}
.switch input{width:40px; height:22px; appearance:none; background:#23305c; border-radius:999px; position:relative; outline:none; cursor:pointer; border:1px solid #31427d}
.switch input:checked{background:#3051c7}
.switch input::after{content:""; position:absolute; top:2px; left:2px; width:18px; height:18px; background:#fff; border-radius:50%; transition:left .2s}
.switch input:checked::after{left:20px}
.lock{font-size:12px; color:#9fb0d8}
.modal-actions{display:flex; gap:10px; justify-content:flex-end; margin-top:14px}
</style>
</head>
<body>

<!-- Neon grid background -->
<div class="bg-grid"></div>

<!-- Loading overlay -->
<div id="loadingOverlay" role="status" aria-label="Loading">
  <svg class="loading-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" aria-hidden="true">
    <defs>
      <linearGradient id="gradBolt2" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#7559ff"/><stop offset="100%" stop-color="#38fbd0"/>
      </linearGradient>
    </defs>
    <polygon points="24,4 44,28 32,28 48,60 20,32 34,32" fill="url(#gradBolt2)"/>
  </svg>
</div>

<!-- Top navigation (shared) -->
<div class="nav">
  <div class="nav-inner">
    <a class="brand" href="index.html" aria-label="Wattrix home">
      <svg class="bolt" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" aria-hidden="true">
        <defs><linearGradient id="g1" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#7559ff"/><stop offset="1" stop-color="#38fbd0"/></linearGradient></defs>
        <polygon points="24,4 44,28 32,28 48,60 20,32 34,32" fill="url(#g1)"/>
      </svg>
      <span class="name">WATTRIX</span>
    </a>

    <nav class="links" aria-label="Primary">
      <a href="index.html">Home</a>
      <a href="calculator.html">Calculator</a>
      <a href="about.html" class="active">About</a>
    </nav>

    <div class="nav-cta">
      <a class="btn" href="#faq">FAQ</a>
      <a class="btn primary" href="calculator.html">Open Calculator</a>
    </div>
  </div>
</div>

<!-- Header -->
<header class="header">
  <div class="container">
    <h1>About Wattrix</h1>
    <p class="lead">A local-first EV planning toolkit. Design tokens match across pages, UI remains consistent, and results stay on your device.</p>
  </div>
</header>

<main>
  <!-- About -->
  <section class="section">
    <div class="container grid cols-2">
      <article class="card">
        <h2>Purpose</h2>
        <p class="muted">Trip energy, time, and cost get estimated quickly. Inputs are kept simple, the breakdown is readable, and conservative planning is encouraged.</p>
        <div class="mono" style="margin-top:10px">Usable kWh • Wh/km or Wh/mi • kW • Buffer • Price/kWh</div>
        <div style="margin-top:10px">
          <span class="pill">Local-first</span>
          <span class="pill">No signup</span>
          <span class="pill">Instant results</span>
        </div>
      </article>

      <article class="card">
        <h2>How it works</h2>
        <p class="muted">Enter your EV and trip details. The calculator estimates energy needs, charging time, and cost. Results update instantly and can be stored locally on your device.</p>
        <div class="mono" style="margin-top:10px">Local storage • Optional analytics • Optional ads</div>
        <div style="margin-top:10px">
          <span class="pill">Fast math</span>
          <span class="pill">Clear breakdown</span>
          <span class="pill">Privacy-aware</span>
        </div>
      </article>
    </div>
  </section>

  <!-- Features -->
  <section class="section">
    <div class="container grid cols-3">
      <article class="card">
        <h2>Inputs</h2>
        <p class="muted">Capacity, efficiency, charger power, price, distance, buffer, state of charge, and planned pre-trip charging are supported.</p>
      </article>
      <article class="card">
        <h2>Computation</h2>
        <p class="muted">Energy shortfall and time at the given kW are derived. A clear suggestion line indicates a minimum top-up time before departure.</p>
      </article>
      <article class="card">
        <h2>Output</h2>
        <p class="muted">KPIs summarize energy, time, and cost. A breakdown lists assumptions, shortfall, and destination battery state.</p>
      </article>
    </div>
  </section>

  <!-- Privacy & Disclaimer -->
  <section class="section">
    <div class="container grid cols-2">
      <article class="card">
        <h2>Privacy</h2>
        <p class="muted">Inputs may be stored locally in your browser (LocalStorage) to improve your experience. Data isn’t sent to us unless you consent to analytics or interact with ads.</p>
        <p class="mono">Note: <em>Sivuston toiminnan ja turvallisuuden kannalta välttämättömät evästeet</em> (strictly necessary cookies) are always on.</p>
      </article>
      <article class="card">
        <h2>Disclaimer</h2>
        <p class="muted">Results are estimates. Actual consumption, charging speed, and availability vary. Extra buffer is recommended for unfamiliar routes and harsh conditions.</p>
      </article>
    </div>
  </section>

  <!-- Roadmap -->
  <section class="section">
    <div class="container">
      <article class="card">
        <h2>Roadmap</h2>
        <ul class="muted" style="margin:10px 0 0 18px">
          <li>Optional Finnish/English content toggle</li>
          <li>Per-vehicle efficiency presets and seasonal multipliers</li>
          <li>Multi-stop planning with per-stop power and price</li>
          <li>Export of breakdown as PDF</li>
        </ul>
      </article>
    </div>
  </section>

  <!-- FAQ -->
  <section class="section" id="faq" aria-labelledby="faq-title">
    <div class="container">
      <article class="card">
        <h2 id="faq-title">FAQ</h2>
        <div class="muted" style="margin-bottom:10px">Common questions and concise answers.</div>

        <details open>
          <summary>Are prices or efficiency real-time?</summary>
          <div class="faq-body">No. Static inputs are used. A preferred kWh price and a realistic efficiency value should be entered.</div>
        </details>

        <details>
          <summary>Does AC vs DC charging get modeled?</summary>
          <div class="faq-body">A linear time estimate is provided at the entered kW. Real DC charging tapers at higher states of charge, so a conservative kW value is recommended.</div>
        </details>

        <details>
          <summary>How should efficiency be entered?</summary>
          <div class="faq-body">Wh/km or Wh/mi may be used. Speed, temperature, wind, elevation, and load influence the correct value strongly.</div>
        </details>

        <details>
          <summary>Will the app require an account?</summary>
          <div class="faq-body">No. The tool is local-first and account-free. Inputs can be retained via LocalStorage on your device.</div>
        </details>

        <details>
          <summary>Who builds Wattrix and how can feedback be sent?</summary>
          <div class="faq-body">Wattrix is produced by Fhatal Oy. Ideas and issues can be shared via <a href="https://fhatal.com" target="_blank" rel="noopener">Fhatal.com</a>.</div>
        </details>

        <!-- Cookies & GDPR additions -->
        <details>
          <summary>What cookies and storage do you use?</summary>
          <div class="faq-body">
            <p><em>Sivuston toiminnan ja turvallisuuden kannalta välttämättömät evästeet</em> (strictly necessary cookies) are always on for security and core functionality. Optional categories:</p>
            <ul>
              <li><strong>Analytics</strong> (Google Analytics 4) — helps improve the site via aggregated usage.</li>
              <li><strong>Ads/Marketing</strong> (Google AdSense) — ad delivery and measurement.</li>
            </ul>
            <p>We also use <code>localStorage</code> to save your calculator inputs locally.</p>
          </div>
        </details>

        <details>
          <summary>How do you comply with EU GDPR/ePrivacy?</summary>
          <div class="faq-body">
            <ul>
              <li>Strictly necessary cookies run without consent to provide the service you request.</li>
              <li>Analytics and Ads/Marketing only run after your explicit opt-in. You can withdraw anytime.</li>
              <li>Consent Mode v2 is enabled for Google tags so behavior reflects your choice.</li>
            </ul>
          </div>
        </details>

        <details>
          <summary>Do you share data with third parties?</summary>
          <div class="faq-body">Only if you opt in. Analytics data may be sent to Google Analytics 4. Ads/Marketing may share data with Google AdSense and ad partners to deliver and measure ads.</div>
        </details>

        <details>
          <summary>How can I change my cookie choices or exercise my rights?</summary>
          <div class="faq-body">
            <ul>
              <li>Click <button class="btn" type="button" id="manageCookies">Manage cookies</button> to reopen the preferences modal.</li>
              <li>Clear site data in your browser to remove local data.</li>
              <li>For rights requests (access, erasure, etc.), contact: <a href="mailto:support@fhatal.com">support@fhatal.com</a>.</li>
            </ul>
          </div>
        </details>

      </article>
    </div>
  </section>
</main>

<footer>
  &copy; 2025 <a href="https://fhatal.com" style="color:var(--brand-2); text-decoration:none;">Fhatal.com</a>
  · <button id="footerManageCookies" class="btn btn-inline" type="button">Manage cookies</button>
</footer>

<!-- ===== Cookie banner (first layer) ===== -->
<div id="cookieBanner" class="cookie-banner cb-hidden" role="region" aria-label="Cookie notice">
  <div class="cb-inner">
    <div class="cb-text">
      <strong>We use cookies for site functionality, analytics, and ads.</strong><br />
      <small><em>Sivuston toiminnan ja turvallisuuden kannalta välttämättömät evästeet</em> are always on. Choose the rest below.</small>
    </div>
    <div class="cb-actions">
      <button class="btn" id="cb-reject">Reject non-essential</button>
      <button class="btn" id="cb-customize">Customize</button>
      <button class="btn primary" id="cb-accept">Accept all</button>
    </div>
  </div>
</div>

<!-- ===== Preferences modal (second layer) ===== -->
<div id="cookieModal" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="cookieTitle">
    <h3 id="cookieTitle">Cookie Preferences</h3>
    <p class="mono">Select what you want to allow. Necessary cookies are always on.</p>

    <div class="row">
      <div style="flex:1">
        <strong>Necessary</strong> <span class="lock">(always active)</span>
        <div class="mono">Security, load balancing, consent storage.</div>
      </div>
      <div class="switch"><input type="checkbox" checked disabled aria-label="Necessary cookies always active"></div>
    </div>

    <div class="row">
      <div style="flex:1">
        <strong>Analytics</strong>
        <div class="mono">Anonymous/aggregated usage measurement (e.g., page views).</div>
      </div>
      <div class="switch"><input id="consent-analytics" type="checkbox" aria-label="Enable analytics"></div>
    </div>

    <div class="row">
      <div style="flex:1">
        <strong>Ads/Marketing</strong>
        <div class="mono">Ad delivery and measurement. May involve partners setting cookies.</div>
      </div>
      <div class="switch"><input id="consent-ads" type="checkbox" aria-label="Enable ads and marketing"></div>
    </div>

    <div class="modal-actions">
      <button class="btn" id="modal-reject">Reject non-essential</button>
      <button class="btn primary" id="modal-save">Save choices</button>
      <button class="btn" id="modal-accept">Accept all</button>
    </div>
  </div>
</div>

<script>
/* Loading overlay — identical logic across pages */
window.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    const overlay = document.getElementById('loadingOverlay');
    overlay.classList.add('hide');
    setTimeout(() => overlay.remove(), 700);
  }, 1200);
});

/* ---------- Consent Manager (same key site-wide) ---------- */
(function(){
  const $ = id => document.getElementById(id);
  const KEY='wattrix_cookie_consent_v2';
  const banner=$('cookieBanner');
  const modal=$('cookieModal');
  const aChk=$('consent-analytics');
  const mChk=$('consent-ads');

  function getConsent(){ try{return JSON.parse(localStorage.getItem(KEY))||null;}catch(e){return null;} }
  function setConsent(obj){
    localStorage.setItem(KEY, JSON.stringify({...obj, ts:new Date().toISOString(), v:2}));
  }
  function showBanner(){ banner.classList.remove('cb-hidden'); }
  function hideBanner(){ banner.classList.add('cb-hidden'); }
  function openModal(){ modal.style.display='block'; modal.setAttribute('aria-hidden','false'); }
  function closeModal(){ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); }

  // Optional: convert <script type="text/plain" data-consent="..."> blocks if you add any
  function runDeferredScripts(consent){
    const allowed = new Set(['necessary']);
    if(consent.analytics) allowed.add('analytics');
    if(consent.ads)       allowed.add('ads');
    document.querySelectorAll('script[type="text/plain"][data-consent]').forEach(tag=>{
      const need = tag.getAttribute('data-consent');
      if(!allowed.has(need)) return;
      const s=document.createElement('script');
      for(const {name,value} of Array.from(tag.attributes)){
        if(name==='type' || name==='data-consent') continue;
        s.setAttribute(name,value);
      }
      s.text = tag.text;
      tag.parentNode.replaceChild(s, tag);
    });
  }

  const saved=getConsent();
  if(!saved){ showBanner(); } else { runDeferredScripts(saved); if (window.__wattrixLoadGtag) window.__wattrixLoadGtag(saved); }

  $('cb-reject').onclick = ()=>{ const c={necessary:true, analytics:false, ads:false}; setConsent(c); hideBanner(); closeModal(); };
  $('cb-accept').onclick = ()=>{ const c={necessary:true, analytics:true, ads:true}; setConsent(c); hideBanner(); closeModal(); runDeferredScripts(c); if (window.__wattrixLoadGtag) window.__wattrixLoadGtag(c); };
  $('cb-customize').onclick = ()=>{ const c=saved||{necessary:true, analytics:false, ads:false}; if(aChk) aChk.checked=!!c.analytics; if(mChk) mChk.checked=!!c.ads; openModal(); };

  $('modal-reject').onclick = ()=>{ const c={necessary:true, analytics:false, ads:false}; setConsent(c); hideBanner(); closeModal(); };
  $('modal-accept').onclick = ()=>{ const c={necessary:true, analytics:true, ads:true}; setConsent(c); hideBanner(); closeModal(); runDeferredScripts(c); if (window.__wattrixLoadGtag) window.__wattrixLoadGtag(c); };
  $('modal-save').onclick = ()=>{ const c={necessary:true, analytics:!!aChk.checked, ads:!!mChk.checked}; setConsent(c); hideBanner(); closeModal(); runDeferredScripts(c); if (window.__wattrixLoadGtag) window.__wattrixLoadGtag(c); };

  const manage = ()=>{ const c=getConsent()||{necessary:true, analytics:false, ads:false}; if(aChk) aChk.checked=!!c.analytics; if(mChk) mChk.checked=!!c.ads; openModal(); };
  const m1=$('manageCookies'); if(m1) m1.onclick=manage;
  const m2=$('footerManageCookies'); if(m2) m2.onclick=manage;
})();
</script>

<!-- ✅ Google Analytics 4 + AdSense loader (Consent Mode v2) -->
<script>
(function(){
  const GA_ID = 'G-WPLMYR2M1F';                
  const ADS_CLIENT = 'ca-pub-2697517525197581'; 

  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }

  window.__wattrixLoadGtag = function(consent){
    if (window.__gtagLoaded) {
      gtag('consent', 'update', {
        ad_storage: consent.ads ? 'granted' : 'denied',
        ad_user_data: consent.ads ? 'granted' : 'denied',
        ad_personalization: consent.ads ? 'granted' : 'denied',
        analytics_storage: consent.analytics ? 'granted' : 'denied',
        functionality_storage: 'granted',
        security_storage: 'granted'
      });
      return;
    }

    const s = document.createElement('script');
    s.async = true;
    s.src = 'https://www.googletagmanager.com/gtag/js?id=' + encodeURIComponent(GA_ID);
    document.head.appendChild(s);

    window.__gtagLoaded = true;
    gtag('js', new Date());

    gtag('consent', 'default', {
      ad_storage: consent.ads ? 'granted' : 'denied',
      ad_user_data: consent.ads ? 'granted' : 'denied',
      ad_personalization: consent.ads ? 'granted' : 'denied',
      analytics_storage: consent.analytics ? 'granted' : 'denied',
      functionality_storage: 'granted',
      security_storage: 'granted'
    });

    gtag('config', GA_ID, { anonymize_ip: true });

    if (consent.ads) {
      const s2 = document.createElement('script');
      s2.async = true;
      s2.crossOrigin = 'anonymous';
      s2.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=' + encodeURIComponent(ADS_CLIENT);
      s2.setAttribute('data-ad-client', ADS_CLIENT);
      document.head.appendChild(s2);
    }
  };
})();
</script>
</body>
</html>
